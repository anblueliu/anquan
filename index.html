<!DOCTYPE html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>追溯查询</title>
    <link rel="stylesheet" href="./public/dist/css/layui.css">
    <link rel="stylesheet" href="./public/dist/css/swiper.min.css">

    <link rel="stylesheet" href="./css/index.css">
</head>

<body>
    <div class="container">
        <div class="background">
            <img src="./images/background.jpg" alt="">
        </div>
        <form class="layui-form" action="">
            <div class="content">
                <div class="head">
                    <div class="head-lt">JLFZFDA</div>
                    <div class="head-rt">
                        <div class='head-c'>吉林(中国-新加坡)食品区食品药品监督管理局保障体系综合监管平台</div>
                        <div class='head-p'>Jilin Food Zone Food And Drug Administration Security System Integrated Supervision Platform</div>
                    </div>
                </div>

                <div class="layui-tab" lay-filter="test1">
                    <ul class="layui-tab-title">
                        <li class="layui-this">产品溯源</li>
                        <!-- <li>耳标号</li> -->
                        <li>政策信息</li>
                        <li>宣传告示</li>
                        <li>安全信息</li>
                        <li>通知公告</li>
                        <li>监管信息</li>
                        <li>行业动态</li>
                        <li>投诉建议</li>
                    </ul>
                    <div class="layui-tab-content">
                        <div class="layui-tab-item layui-show">
                            <div class="item-content">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">输入条形码</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" placeholder="请输入条形码" autocomplete="off" class="layui-input" id='barcode'>
                                    </div>
                                </div>
                                <div class="layui-form-item">

                                    <label class="layui-form-label">输入批次号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" placeholder="请输入批次号" autocomplete="off" class="layui-input" id='batch'>
                                    </div>
                                </div>
                                <button class="layui-btn layui-btn-normal" id='btnform'>
                                            <i class="layui-icon layui-icon-search"></i> 查询
                                    </button>
                            </div>
                            <div class="show">
                                <div class="product">
                                    <div class="base">
                                        <div class="title">产品基本信息</div>
                                        <div class="product-content">
                                            <div class="lt">
                                                <div class="product-img">
                                                    <img src="" alt="" id="detailimage">
                                                </div>
                                            </div>
                                            <div class="cr">

                                                <div class="item" id='detailbatch'>
                                                    产品批次:20190117
                                                </div>
                                                <div class="item" id='detailshelflife'>
                                                    保质期:12个月
                                                </div>
                                                <div class="item" id='detailname'>
                                                    产品名称:玉米糊
                                                </div>
                                                <div class="item" id='detailbrand'>
                                                    产品品牌:明双
                                                </div>

                                            </div>
                                            <div class="rt">
                                                <div class="item" id='detailspecifications'>
                                                    产品规格:400g/袋
                                                </div>
                                                <div class="item" id='detailbarcode'>
                                                    产品条码:6970376800525
                                                </div>
                                                <div class="item" id='detailstandard'>
                                                    执行标准:Q/JLMX0050s-2017
                                                </div>
                                                <div class="item" id='detaildate'>
                                                    生成日期:2019-01-17
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="detection">
                                        <div class="title">产品检测信息</div>
                                        <table class="layui-table">
                                            <thead>
                                                <tr>
                                                    <th>检测日期</th>
                                                    <th>检测人员</th>
                                                    <th>检测机构</th>
                                                    <th>检测依据</th>
                                                    <th>检测项目和结果</th>
                                                    <th>检测结论</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td id='detectiondate'>2019-01-17</td>
                                                    <td id='detectionpeople'>明兴农业</td>
                                                    <td id='detectioninstitution'>明兴</td>
                                                    <td id='detectiongist'>企业标准</td>
                                                    <td id='detectionresult'>外观色泽:正常</td>
                                                    <td id='detectionconclusion'>合格</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>

                                    <div class="material">
                                        <div class="title">原辅料信息</div>
                                        <div class="swiper-container">
                                            <div class="swiper-wrapper">
                                                <div class="swiper-slide">
                                                    <!-- <div class="material-item">
                                                        <div class="material-item-img">
                                                            <img src="" alt="" class='materialimage'>
                                                        </div>
                                                        <div class="material-item-info">
                                                            <div class="item materialname">名称:棉花糖</div>
                                                            <div class="item materialspecies">种类:食糖</div>
                                                            <div class="item materialspecifications">规定:25kg/袋</div>
                                                            <div class="item materialshelflife">保质期:18个月</div>
                                                            <div class="item materialstandard">执行标准号:GB1445-2000</div>
                                                        </div>
                                                    </div> -->
                                                </div>

                                            </div>
                                            <div class="swiper-pagination"></div>

                                        </div>
                                    </div>
                                    <div class="company">
                                        <div class="title">生产企业信息</div>
                                        <div class="company-content">
                                            <div class="item" id="companyname">企业名称:吉林明兴农产品有限公司</div>
                                            <div class="item" id="companyscope">经营范围:粮食加工品,其他粮食加工品</div>
                                            <div class="item" id="companylicense">营业制造号:91220221673343120A</div>
                                            <div class="item" id="companyphone">联系电话:18686300456</div>
                                            <div class="item" id="companyaddress">企业地址:吉林省吉林(中国-新加坡)食品工业园区</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="layui-tab-item">
                            <div class="item-content">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">输入耳标号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="title" required lay-verify="required" placeholder="请输入追溯号" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <button class="layui-btn layui-btn-normal">
                                            <i class="layui-icon layui-icon-search"></i> 查询
                                    </button>

                            </div>
                        </div>
                        <div class="layui-tab-item">

                        </div>

                        <div class="layui-tab-item">
                            dsfdsfs
                        </div>

                        <div class="layui-tab-item">
                            dsfsfsdsfsfs
                        </div>

                        <div class="layui-tab-item">
                            dsfsfsdfsfsdfsf
                        </div>

                        <div class="layui-tab-item">
                            dsfsfdsfdsfdsfdffs
                        </div>

                        <div class="layui-tab-item">
                            fsdfsffdsfsf孙菲菲付付所
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </div>

</body>
<script src="./public/dist/layui.js"></script>
<script src="./public/dist/js/swiper.min.js"></script>
<script src='./js/info.js'></script>
<script>
    //注意：选项卡 依赖 element 模块，否则无法进行功能性操作
    layui.use(['form', 'element', "layer"], function() {
        var element = layui.element,
            form = layui.form,
            $ = layui.$,
            layer = layui.layer,
            carousel = layui.carousel;


        //监听切换
        element.on('tab(test1)', function(tt) {
            var sb = String(tt.index);

            $.ajax({
                type: 'GET',
                url: 'http://192.168.1.103:9527/gzaqzs/getInformation',
                data: {
                    newsType: sb
                },
                success: function(data) {
                    console.log(data)
                },
                error: function(jqXHR) {}
            });

        });

    });
</script>
<script>
    var swiper = new Swiper('.swiper-container', {
        pagination: {
            el: '.swiper-pagination',
            type: 'fraction',
        },
        autoplay: {
            delay: 3000,
            stopOnLastSlide: false,
            disableOnInteraction: false,
        },
        loop: true,
    });
    swiper.el.onmouseover = function() {
        swiper.autoplay.stop();
    }
    swiper.el.onmouseout = function() {
        swiper.autoplay.start();
    }


    // console.log(info);
    var btnform = document.querySelector('#btnform');
    var show = document.querySelector('.show');

    var detailimage = document.querySelector('#detailimage');
    var detailname = document.querySelector('#detailname');
    var detailbrand = document.querySelector('#detailbrand');
    var detailspecifications = document.querySelector('#detailspecifications');
    var detailshelflife = document.querySelector('#detailshelflife');
    var detailbatch = document.querySelector('#detailbatch');
    var detaildate = document.querySelector('#detaildate');
    var detailbarcode = document.querySelector('#detailbarcode');
    var detailstandard = document.querySelector('#detailstandard');

    var detectiondate = document.querySelector('#detectiondate');
    var detectionpeople = document.querySelector('#detectionpeople');
    var detectioninstitution = document.querySelector('#detectioninstitution');
    var detectiongist = document.querySelector('#detectiongist');
    var detectionresult = document.querySelector('#detectionresult');
    var detectionconclusion = document.querySelector('#detectionconclusion');

    var companyname = document.querySelector('#companyname');
    var companyscope = document.querySelector('#companyscope');
    var companylicense = document.querySelector('#companylicense');
    var companyphone = document.querySelector('#companyphone');
    var companyaddress = document.querySelector('#companyaddress');

    var swiperWrapper = document.querySelector('.swiper-wrapper');
    var company = document.querySelector('.company');
    var detection = document.querySelector('.detection');
    // 是否存在此产品
    var ifexist = 0;
    // 查询事件
    btnform.addEventListener('click', function() {
        show.style.display = 'none';
        company.style.display = 'none';
        detection.style.display = 'none';
        swiper.removeAllSlides();
        var barcodeVal = document.querySelector('#barcode').value;
        var batch = document.querySelector('#batch').value;
        console.log(barcodeVal);
        for (var i = 0; i < info.length; i++) {
            if (batch == info[i].detail.batch) {
                company.style.display = 'block';
                detection.style.display = 'block';
            }
            // 判断批条形码是否正确
            if (barcodeVal == info[i].detail.barcode) {
                // 判断批次号是否正确
                if (batch != info[i].detail.batch && batch != '') {
                    layui.use('layer', function() {
                        var layer = layui.layer;

                        layer.msg('请正确输入批次号!');
                    });
                }
                ifexist = 1;

                show.style.display = 'block';
                detailimage.src = info[i].detail.image;
                detailname.innerHTML = '产品名称:' + info[i].detail.name;
                detailbrand.innerHTML = '产品品牌:' + info[i].detail.brand;
                detailspecifications.innerHTML = '产品规格:' + info[i].detail.specifications;
                detailshelflife.innerHTML = '保质期:' + info[i].detail.shelflife;
                detailbatch.innerHTML = '产品批次:' + info[i].detail.batch;
                detaildate.innerHTML = '生成日期:' + info[i].detail.date;
                detailbarcode.innerHTML = '产品条码:' + info[i].detail.barcode;
                detailstandard.innerHTML = '执行标准:' + info[i].detail.standard;
                detectiondate.innerHTML = '' + info[i].detection.date;
                detectionpeople.innerHTML = '' + info[i].detection.people;
                detectioninstitution.innerHTML = '' + info[i].detection.institution;
                detectiongist.innerHTML = '' + info[i].detection.gist;
                detectionresult.innerHTML = '' + info[i].detection.result;
                detectionconclusion.innerHTML = '' + info[i].detection.conclusion;
                companyname.innerHTML = '企业名称:' + info[i].company.name;
                companyscope.innerHTML = '经营范围:' + info[i].company.scope;
                companylicense.innerHTML = '营业制造号:' + info[i].company.license;
                companyphone.innerHTML = '联系电话:' + info[i].company.phone;
                companyaddress.innerHTML = '企业地址:' + info[i].company.address;
                var slide = 0;
                if (info[i].material.length % 2 == 1) {
                    slide = Math.ceil(info[i].material.length / 2) - 1;
                    console.log("slide" + slide)

                } else {
                    slide = Math.ceil(info[i].material.length / 2);
                    console.log("slide" + slide)
                }
                swiperWrapper.innerHTML = ''
                    // 添加原辅料
                for (var j = 0; j < slide; j++) {
                    console.log("slide" + slide)
                    swiper.appendSlide('<div class="swiper-slide">'

                        +
                        '<div class="material-item">' +
                        '<div class="material-item-img">' +
                        '<img src="' +
                        info[i].material[j * 2].image +
                        '" alt="" class="materialimage">' +
                        '</div>' +
                        '<div class="material-item-info">' +
                        '<div class="item materialname">名称:' + info[i].material[j * 2].name + '</div>' +
                        '<div class="item materialspecies">种类:' + info[i].material[j * 2].species + '</div>' +
                        '<div class="item materialspecifications">规定:' + info[i].material[j * 2].specifications + '</div>' +
                        '<div class="item materialshelflife">保质期:' + info[i].material[j * 2].shelflife + '</div>' +
                        '<div class="item materialstandard">执行标准号:' + info[i].material[j * 2].standard + '</div>' +
                        '</div>' +
                        '</div>'

                        +
                        '<div class="material-item">' +
                        '<div class="material-item-img">' +
                        '<img src="' +
                        info[i].material[j * 2 + 1].image +
                        '" alt="" class="materialimage">' +
                        '</div>' +
                        '<div class="material-item-info">' +
                        '<div class="item materialname">名称:' + info[i].material[j * 2 + 1].name + '</div>' +
                        '<div class="item materialspecies">种类:' + info[i].material[j * 2 + 1].species + '</div>' +
                        '<div class="item materialspecifications">规定:' + info[i].material[j * 2 + 1].specifications + '</div>' +
                        '<div class="item materialshelflife">保质期:' + info[i].material[j * 2 + 1].shelflife + '</div>' +
                        '<div class="item materialstandard">执行标准号:' + info[i].material[j * 2 + 1].standard + '</div>' +
                        '</div>' +
                        '</div>'

                        +
                        '</div>');

                }

                var materialLength = info[i].material.length - 1
                if (info[i].material.length % 2 == 1) {
                    swiper.appendSlide('<div class="swiper-slide">'

                        +
                        '<div class="material-item">' +
                        '<div class="material-item-img">' +
                        '<img src="' +
                        info[i].material[info[i].material.length - 1].image +
                        '" alt="" class="materialimage">' +
                        '</div>' +
                        '<div class="material-item-info">' +
                        '<div class="item materialname">名称:' + info[i].material[materialLength].name + '</div>' +
                        '<div class="item materialspecies">种类:' + info[i].material[materialLength].species + '</div>' +
                        '<div class="item materialspecifications">规定:' + info[i].material[materialLength].specifications + '</div>' +
                        '<div class="item materialshelflife">保质期:' + info[i].material[materialLength].shelflife + '</div>' +
                        '<div class="item materialstandard">执行标准号:' + info[i].material[materialLength].standard + '</div>' +
                        '</div>' +
                        '</div>' +
                        '</div>')
                }


            }
        }

        // 判断是否存在商品,没有则显示
        if (ifexist == 0) {
            layui.use('layer', function() {
                var layer = layui.layer;

                layer.msg('请正确输入条形码!');
            });
        }

        ifexist = 0;
    })
</script>

</html>